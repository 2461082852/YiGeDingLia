{"version":3,"sources":["index.tsx"],"names":["getFirstPinyin","pinyin","normalize","replace","getLastPinyin","indexed","json","result","firstPinyin","lastPinyin","word","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","Symbol","iterator","next","done","data","value","length","key1","values1","push","key2","values2","err","return","pinyins","Set","_loop","level","newpinyins","forEach","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","add","console","log","concat","size","handle","input","state","_loop2","v","filtered","filter","d","Math","floor","random","_ret","ReactDOM","render","react__WEBPACK_IMPORTED_MODULE_2___default","a","createElement","_React$useState","React","useState","_React$useState2","Object","_home_travis_build_ustc_zzzz_YiGeDingLia_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_1__","setState","_React$useState3","_React$useState4","seq","setSeq","keys","className","type","onChange","e","target","map","key","href","error","style","color","url","fetch","then","res","catch","_home_travis_build_ustc_zzzz_YiGeDingLia_node_modules_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_0__","document","getElementsByTagName"],"mappings":"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","file":"static/js/main.55276fbc.chunk.js","sourcesContent":["import React from 'react';\nimport ReactDOM from 'react-dom';\n\nimport './github-markdown.css';\n\ninterface Data {\n  abbreviation: string\n  derivation: string\n  example: string\n  explanation: string\n  pinyin: string\n  word: string\n  level?: number\n}\n\ninterface State {\n  firstPinyin: {\n    [key: string]: Data[]\n  }\n  lastPinyin: {\n    [key: string]: Data[]\n  }\n  word: {\n    [key: string]: Data\n  }\n  error?: string\n}\n\nconst getFirstPinyin = (pinyin: string) => {\n  return pinyin.normalize('NFKD').replace(/[^\\w\\s]|\\s.+/g, '')\n}\n\nconst getLastPinyin = (pinyin: string) => {\n  return pinyin.normalize('NFKD').replace(/[^\\w\\s]|.+\\s/g, '')\n}\n\nconst indexed = (json: Data[]) => {\n  const result: State = { firstPinyin: {}, lastPinyin: {}, word: {} }\n  for (const data of json) {\n    if (data.word.length === 4) {\n      const key1 = getLastPinyin(data.pinyin)\n      const values1 = result.lastPinyin[key1] || []\n      result.lastPinyin[key1] = values1\n      values1.push(data)\n\n      const key2 = getFirstPinyin(data.pinyin)\n      const values2 = result.firstPinyin[key2] || []\n      result.firstPinyin[key2] = values2\n      values2.push(data)\n\n      result.word[data.word] = data\n    }\n  }\n  let pinyins = new Set(['yi'])\n  for (let level = 1; pinyins.size > 0; ++level) {\n    const newpinyins = new Set<string>()\n    pinyins.forEach(pinyin => {\n      for (const data of result.lastPinyin[pinyin] || []) {\n        if (!data.level) {\n          data.level = level\n          newpinyins.add(getFirstPinyin(data.pinyin))\n        }\n      }\n    })\n    console.log(`Generate ${newpinyins.size} entries for level ${level}`)\n    pinyins = newpinyins\n  }\n  return result\n}\n\nconst handle = (input: string, state: State) => {\n  const result: string[] = []\n  let data = state.word[input]\n  while (data && data.level) {\n    const level = data.level\n    result.push(`${data.word}（${data.pinyin}）`)\n    if (level > 1) {\n      const next = state.firstPinyin[getLastPinyin(data.pinyin)]\n      const filtered = next.filter(d => d.level && d.level < level)\n      data = filtered[Math.floor(Math.random() * filtered.length)]\n    } else {\n      result.push('一个顶俩（yī gè dǐng liǎ）')\n      return result\n    }\n  }\n  return result\n}\n\nfunction App() {\n  const [state, setState] = React.useState<State>({ firstPinyin: {}, lastPinyin: {}, word: {} })\n  const [seq, setSeq] = React.useState<string[]>([])\n\n  if (Object.keys(state.word).length > 0) {\n    return <div className='markdown-body'>\n      <h1>一个顶俩</h1>\n      <p>请输入一个四字成语，如成功识别：</p>\n      <p>本页面将自动为你接龙到“一个顶俩”</p>\n      <p><input type='input' onChange={e => setSeq(handle(e.target.value, state))} /></p>\n      <ul>{seq.map(data => {\n        return <li key={data}>{data}</li>\n      })}</ul>\n      <p>网页来源：<a href='https://github.com/ustc-zzzz/yigedinglia'>https://github.com/ustc-zzzz/yigedinglia</a></p>\n      <p>数据来源：<a href='https://github.com/pwxcoo/chinese-xinhua'>https://github.com/pwxcoo/chinese-xinhua</a></p>\n    </div>\n  } else if (state.error) {\n    return <div className='markdown-body'>\n      <h1>一个顶俩</h1>\n      <p style={{color: 'red'}}>{`数据加载中...加载异常，请刷新重试：${state.error}`}</p>\n      <p>网页来源：<a href='https://github.com/ustc-zzzz/yigedinglia'>https://github.com/ustc-zzzz/yigedinglia</a></p>\n      <p>数据来源：<a href='https://github.com/pwxcoo/chinese-xinhua'>https://github.com/pwxcoo/chinese-xinhua</a></p>\n    </div>\n  } else {\n    const base = 'https://raw.githubusercontent.com'\n    const url = `${base}/pwxcoo/chinese-xinhua/master/data/idiom.json`\n    fetch(url).then(res => res.json()).then(json => setState(indexed(json))).catch(error => setState({...state, error}))\n    return <div className='markdown-body'>\n      <h1>一个顶俩</h1>\n      <p>数据加载中...</p>\n      <p>网页来源：<a href='https://github.com/ustc-zzzz/yigedinglia'>https://github.com/ustc-zzzz/yigedinglia</a></p>\n      <p>数据来源：<a href='https://github.com/pwxcoo/chinese-xinhua'>https://github.com/pwxcoo/chinese-xinhua</a></p>\n    </div>\n  }\n}\n\nReactDOM.render(<App />, document.getElementsByTagName('main')[0])\n"],"sourceRoot":""}